<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="嵌入式笔记：freertos RTOS 目录简单的任务函数void ATaskFunction( void *pvParameters ) {     int iVariableExample = 0;      /* 任务通常实现在一个死循环中。 */     for( ;; )     {         /* 完成任务功能的代码将放在这里。 */     }     /* 如果任务的具体实现">
<meta property="og:type" content="article">
<meta property="og:title" content="嵌入式笔记：freertos RTOS">
<meta property="og:url" content="http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/index.html">
<meta property="og:site_name" content="xiaxiaowen的个人博客">
<meta property="og:description" content="嵌入式笔记：freertos RTOS 目录简单的任务函数void ATaskFunction( void *pvParameters ) {     int iVariableExample = 0;      /* 任务通常实现在一个死循环中。 */     for( ;; )     {         /* 完成任务功能的代码将放在这里。 */     }     /* 如果任务的具体实现">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-02-28T01:12:17.724Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="嵌入式笔记：freertos RTOS">
<meta name="twitter:description" content="嵌入式笔记：freertos RTOS 目录简单的任务函数void ATaskFunction( void *pvParameters ) {     int iVariableExample = 0;      /* 任务通常实现在一个死循环中。 */     for( ;; )     {         /* 完成任务功能的代码将放在这里。 */     }     /* 如果任务的具体实现">
    
    
        
          
              <link rel="shortcut icon" href="/embedded-notes/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/embedded-notes/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/embedded-notes/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>嵌入式笔记：freertos RTOS</title>
    <!-- styles -->
    <link rel="stylesheet" href="/embedded-notes/css/style.css">
    <!-- rss -->
    
    
<link rel="stylesheet" href="/embedded-notes/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/embedded-notes/css/prism-line-numbers.css" type="text/css"></head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/embedded-notes/">Home</a></li>
         
          <li><a href="/embedded-notes/about/">About</a></li>
         
          <li><a href="/embedded-notes/posts/">Writing</a></li>
         
          <li><a href="http://github.com/xiaowenxia">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/embedded-notes/2018/02/28/gpu/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/embedded-notes/2018/02/28/driver/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&text=嵌入式笔记：freertos RTOS"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&is_video=false&description=嵌入式笔记：freertos RTOS"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=嵌入式笔记：freertos RTOS&body=Check out this article: http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&name=嵌入式笔记：freertos RTOS&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#目录"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简单的任务函数"><span class="toc-number">1.1.</span> <span class="toc-text">简单的任务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建任务函数"><span class="toc-number">1.2.</span> <span class="toc-text">创建任务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除任务函数"><span class="toc-number">1.3.</span> <span class="toc-text">删除任务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#任务优先级"><span class="toc-number">1.4.</span> <span class="toc-text">任务优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延时函数"><span class="toc-number">1.5.</span> <span class="toc-text">延时函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#精确延时函数"><span class="toc-number">1.5.1.</span> <span class="toc-text">精确延时函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空闲任务"><span class="toc-number">1.6.</span> <span class="toc-text">空闲任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#队列"><span class="toc-number">1.7.</span> <span class="toc-text">队列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建队列"><span class="toc-number">1.7.1.</span> <span class="toc-text">创建队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写入到队列首"><span class="toc-number">1.7.2.</span> <span class="toc-text">写入到队列首</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写入到队列尾"><span class="toc-number">1.7.3.</span> <span class="toc-text">写入到队列尾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发送队列"><span class="toc-number">1.7.4.</span> <span class="toc-text">发送队列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统运行过程"><span class="toc-number">1.8.</span> <span class="toc-text">系统运行过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#协程–croutine-c"><span class="toc-number">1.9.</span> <span class="toc-text">协程–croutine.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#链表设计–List-c"><span class="toc-number">1.10.</span> <span class="toc-text">链表设计–List.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统调度"><span class="toc-number">1.11.</span> <span class="toc-text">系统调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#任务管理"><span class="toc-number">1.12.</span> <span class="toc-text">任务管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内存管理"><span class="toc-number">1.13.</span> <span class="toc-text">内存管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优先级反转"><span class="toc-number">1.14.</span> <span class="toc-text">优先级反转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优先级继承"><span class="toc-number">1.15.</span> <span class="toc-text">优先级继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#freertos-HOOK函数"><span class="toc-number">1.16.</span> <span class="toc-text">freertos HOOK函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#freertos栈溢出检测的2种方法"><span class="toc-number">1.17.</span> <span class="toc-text">freertos栈溢出检测的2种方法</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        嵌入式笔记：freertos RTOS
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">xiaxiaowen的个人博客</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-02-28T01:20:44.969Z" itemprop="datePublished">2018-02-28</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>嵌入式笔记：freertos RTOS</p>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><h2 id="简单的任务函数"><a href="#简单的任务函数" class="headerlink" title="简单的任务函数"></a>简单的任务函数</h2><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">ATaskFunction</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvParameters <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> iVariableExample <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/* 任务通常实现在一个死循环中。 */</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/* 完成任务功能的代码将放在这里。 */</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">/* 如果任务的具体实现会跳出上面的死循环，则此任务必须在函数运行完之前删除。传入NULL参数表示删除的是当前任务 */</span>
    <span class="token function">vTaskDelete</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="创建任务函数"><a href="#创建任务函数" class="headerlink" title="创建任务函数"></a>创建任务函数</h2><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 函数原型 */</span>
portBASE_TYPE <span class="token function">xTaskCreate</span><span class="token punctuation">(</span> pdTASK_CODE pvTaskCode<span class="token punctuation">,</span>
                            <span class="token keyword">const</span> <span class="token keyword">signed</span> portCHAR <span class="token operator">*</span> <span class="token keyword">const</span> pcName<span class="token punctuation">,</span>
                            <span class="token keyword">unsigned</span> portSHORT usStackDepth<span class="token punctuation">,</span>
                            <span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">,</span>
                            <span class="token keyword">unsigned</span> portBASE_TYPE uxPriority<span class="token punctuation">,</span>
                            xTaskHandle <span class="token operator">*</span>pxCreatedTask <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">/* 函数示例 */</span>
<span class="token keyword">static</span> TaskHandle_t myTaskHandler <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token function">xTaskCreate</span><span class="token punctuation">(</span>ATaskFunction<span class="token punctuation">,</span> <span class="token string">"myTask"</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> configMAX_PRIORITIES <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>myTaskHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="删除任务函数"><a href="#删除任务函数" class="headerlink" title="删除任务函数"></a>删除任务函数</h2><pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 函数原型 */</span>
<span class="token keyword">void</span> <span class="token function">vTaskDelete</span><span class="token punctuation">(</span> xTaskHandle pxTaskToDelete <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="任务优先级"><a href="#任务优先级" class="headerlink" title="任务优先级"></a>任务优先级</h2><p>低优先级号表示任务的优先级低，优先级号0表示最低优先级。有效的优先级号范围从0到<code>(configMAX_PRIORITES – 1)</code>。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>vTaskPrioritySet()</td>
<td>可以动态的更改任务优先级</td>
</tr>
<tr>
<td>uxTaskPriorityGet()</td>
<td>获取任务优先级</td>
</tr>
<tr>
<td>uxTaskPriorityGetFromISR()</td>
<td>在ISR函数中获取任务优先级</td>
</tr>
</tbody>
</table>
<h2 id="延时函数"><a href="#延时函数" class="headerlink" title="延时函数"></a>延时函数</h2><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">vTaskDelay</span><span class="token punctuation">(</span> portTickType xTicksToDelay <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>xTicksToDelay 表示延时多少个tick \<br>该函数会把task切出到阻塞态</p>
</blockquote>
<h3 id="精确延时函数"><a href="#精确延时函数" class="headerlink" title="精确延时函数"></a>精确延时函数</h3><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">vTaskDelayUntil</span><span class="token punctuation">(</span> portTickType <span class="token operator">*</span> pxPreviousWakeTime<span class="token punctuation">,</span> portTickType xTimeIncrement <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>调用此函数的任务解除阻塞的时间是绝对时刻，比起vTaskDelay()延时时间更精确</p>
</blockquote>
<p>使用方法：</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">vTaskFunction</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvParameters <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>pcTaskName<span class="token punctuation">;</span>
    portTickType xLastWakeTime<span class="token punctuation">;</span>
    pcTaskName <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token punctuation">)</span> pvParameters<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/* 变量xLastWakeTime需要被初始化为当前心跳计数值。说明一下，这是该变量唯一一次被显式赋值。之后，
    xLastWakeTime将在函数vTaskDelayUntil()中自动更新。 */</span>
    xLastWakeTime <span class="token operator">=</span> <span class="token function">xTaskGetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">vPrintString</span><span class="token punctuation">(</span> pcTaskName <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">/* 本任务将精确的以250毫秒为周期执行。同vTaskDelay()函数一样，时间值是以心跳周期为单位的，
        可以使用常量portTICK_RATE_MS将毫秒转换为心跳周期。变量xLastWakeTime会在
        vTaskDelayUntil()中自动更新，因此不需要应用程序进行显示更新。 */</span>
        <span class="token function">vTaskDelayUntil</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>xLastWakeTime<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token number">250</span> <span class="token operator">/</span> portTICK_RATE_MS <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="空闲任务"><a href="#空闲任务" class="headerlink" title="空闲任务"></a>空闲任务</h2><blockquote>
<p>调用vTaskStartScheduler()时，调度器会自动创建一个空闲任务 \<br>空闲任务拥有最低优先级(优先级0) \<br>空闲任务是一个非常短小的循环</p>
</blockquote>
<p>具体代码在vTaskStartScheduler()中可以看到：</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">vTaskStartScheduler</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    BaseType_t xReturn<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/* Add the idle task at the lowest priority. */</span>
    <span class="token macro property">#<span class="token directive keyword">if</span> ( INCLUDE_xTaskGetIdleTaskHandle == 1 )</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/* Create the idle task, storing its handle in xIdleTaskHandle so it can
        be returned by the xTaskGetIdleTaskHandle() function. */</span>
        xReturn <span class="token operator">=</span> <span class="token function">xTaskCreate</span><span class="token punctuation">(</span> prvIdleTask<span class="token punctuation">,</span> <span class="token string">"IDLE"</span><span class="token punctuation">,</span> tskIDLE_STACK_SIZE<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token operator">*</span> <span class="token punctuation">)</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> tskIDLE_PRIORITY <span class="token operator">|</span> portPRIVILEGE_BIT <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>xIdleTaskHandle <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/*lint !e961 MISRA exception, justified as it is not a redundant explicit cast to all supported compilers. */</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">#<span class="token directive keyword">else</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/* Create the idle task without storing its handle. */</span>
        xReturn <span class="token operator">=</span> <span class="token function">xTaskCreate</span><span class="token punctuation">(</span> prvIdleTask<span class="token punctuation">,</span> <span class="token string">"IDLE"</span><span class="token punctuation">,</span> tskIDLE_STACK_SIZE<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token operator">*</span> <span class="token punctuation">)</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> tskIDLE_PRIORITY <span class="token operator">|</span> portPRIVILEGE_BIT <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">/*lint !e961 MISRA exception, justified as it is not a redundant explicit cast to all supported compilers. */</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">/* INCLUDE_xTaskGetIdleTaskHandle */</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><h3 id="创建队列"><a href="#创建队列" class="headerlink" title="创建队列"></a>创建队列</h3><pre class="line-numbers language-c"><code class="language-c">xQueueHandle <span class="token function">xQueueCreate</span><span class="token punctuation">(</span> <span class="token keyword">unsigned</span> portBASE_TYPE uxQueueLength<span class="token punctuation">,</span><span class="token keyword">unsigned</span> portBASE_TYPE uxItemSize <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="写入到队列首"><a href="#写入到队列首" class="headerlink" title="写入到队列首"></a>写入到队列首</h3><pre class="line-numbers language-c"><code class="language-c">portBASE_TYPE <span class="token function">xQueueSendToFront</span><span class="token punctuation">(</span> xQueueHandle xQueue<span class="token punctuation">,</span>
                                  <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span> pvItemToQueue<span class="token punctuation">,</span>
                                  portTickType xTicksToWait <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="写入到队列尾"><a href="#写入到队列尾" class="headerlink" title="写入到队列尾"></a>写入到队列尾</h3><pre class="line-numbers language-c"><code class="language-c">portBASE_TYPE <span class="token function">xQueueSendToBack</span><span class="token punctuation">(</span> xQueueHandle xQueue<span class="token punctuation">,</span>
                                <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span> pvItemToQueue<span class="token punctuation">,</span>
                                portTickType xTicksToWait <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="发送队列"><a href="#发送队列" class="headerlink" title="发送队列"></a>发送队列</h3><ul>
<li><a href="#协程--croutine.c">协程–croutine.c</a></li>
</ul>
<h2 id="系统运行过程"><a href="#系统运行过程" class="headerlink" title="系统运行过程"></a>系统运行过程</h2><h2 id="协程–croutine-c"><a href="#协程–croutine-c" class="headerlink" title="协程–croutine.c"></a>协程–croutine.c</h2><p>4个链表：readyList  pendingList  delayList（2个）</p>
<h2 id="链表设计–List-c"><a href="#链表设计–List-c" class="headerlink" title="链表设计–List.c"></a>链表设计–List.c</h2><h2 id="系统调度"><a href="#系统调度" class="headerlink" title="系统调度"></a>系统调度</h2><h2 id="任务管理"><a href="#任务管理" class="headerlink" title="任务管理"></a>任务管理</h2><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><h2 id="优先级反转"><a href="#优先级反转" class="headerlink" title="优先级反转"></a>优先级反转</h2><p>有优先级为A、B和C三个任务，优先级A&gt;B&gt;C，任务A，B处于挂起状态，等待某一事件发生，任务C正在运行，此时任务C开始使用某一共享资源S。在使用中，任务A等待事件到来，任务A转为就绪态，因为它比任务C优先级高，所以立即执行。当任务A要使用共享资源S时，由于其正在被任务C使用，因此任务A被挂起，任务C开始运行。如果此时任务B等待事件到来，则任务B转为就绪态。由于任务B优先级比任务C高，因此任务B开始运行，直到其运行完毕，任务C才开始运行。直到任务C释放共享资源S后，任务A才得以执行。在这种情况下，优先级发生了翻转，任务B先于任务A运行。</p>
<h2 id="优先级继承"><a href="#优先级继承" class="headerlink" title="优先级继承"></a>优先级继承</h2><blockquote>
<p>freertos 使用优先级继承来解决优先级反转问题<br>当任务A 申请共享资源S 时， 如果S正在被任务C 使用，通过比较任务C 与自身的优先级，如发现任务C 的优先级小于自身的优先级， 则将任务C的优先级提升到自身的优先级， 任务C 释放资源S 后，再恢复任务C 的原优先级。</p>
</blockquote>
<h2 id="freertos-HOOK函数"><a href="#freertos-HOOK函数" class="headerlink" title="freertos HOOK函数"></a>freertos HOOK函数</h2><ul>
<li>vApplicationIdleHook()<br>  idle的hook函数</li>
<li>vApplicationTickHook()<br>  系统tick的hook函数</li>
<li>vApplicationMallocFailedHook()<br>  malloc失败的hook函数</li>
<li>vApplicationStackOverflowHook()<br>  栈溢出的hook函数</li>
<li>vApplicationDaemonTaskStartupHook()<br>  vTaskStartScheduler()函数第一次执行的时候调用。</li>
</ul>
<h2 id="freertos栈溢出检测的2种方法"><a href="#freertos栈溢出检测的2种方法" class="headerlink" title="freertos栈溢出检测的2种方法"></a>freertos栈溢出检测的2种方法</h2><ul>
<li>第一种<br>  每次调度都检查一下任务的当前栈有没有超过任务的栈区域。</li>
<li>第二种<br>  每个任务栈最下面会有16个字节是特定的内容，每次调度的时候如果发现这16个字节不正常了，就说明有谁踩到了这个栈。</li>
</ul>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/embedded-notes/">Home</a></li>
         
          <li><a href="/embedded-notes/about/">About</a></li>
         
          <li><a href="/embedded-notes/posts/">Writing</a></li>
         
          <li><a href="http://github.com/xiaowenxia">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#目录"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#简单的任务函数"><span class="toc-number">1.1.</span> <span class="toc-text">简单的任务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建任务函数"><span class="toc-number">1.2.</span> <span class="toc-text">创建任务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除任务函数"><span class="toc-number">1.3.</span> <span class="toc-text">删除任务函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#任务优先级"><span class="toc-number">1.4.</span> <span class="toc-text">任务优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延时函数"><span class="toc-number">1.5.</span> <span class="toc-text">延时函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#精确延时函数"><span class="toc-number">1.5.1.</span> <span class="toc-text">精确延时函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空闲任务"><span class="toc-number">1.6.</span> <span class="toc-text">空闲任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#队列"><span class="toc-number">1.7.</span> <span class="toc-text">队列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建队列"><span class="toc-number">1.7.1.</span> <span class="toc-text">创建队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写入到队列首"><span class="toc-number">1.7.2.</span> <span class="toc-text">写入到队列首</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写入到队列尾"><span class="toc-number">1.7.3.</span> <span class="toc-text">写入到队列尾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发送队列"><span class="toc-number">1.7.4.</span> <span class="toc-text">发送队列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统运行过程"><span class="toc-number">1.8.</span> <span class="toc-text">系统运行过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#协程–croutine-c"><span class="toc-number">1.9.</span> <span class="toc-text">协程–croutine.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#链表设计–List-c"><span class="toc-number">1.10.</span> <span class="toc-text">链表设计–List.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统调度"><span class="toc-number">1.11.</span> <span class="toc-text">系统调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#任务管理"><span class="toc-number">1.12.</span> <span class="toc-text">任务管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内存管理"><span class="toc-number">1.13.</span> <span class="toc-text">内存管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优先级反转"><span class="toc-number">1.14.</span> <span class="toc-text">优先级反转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优先级继承"><span class="toc-number">1.15.</span> <span class="toc-text">优先级继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#freertos-HOOK函数"><span class="toc-number">1.16.</span> <span class="toc-text">freertos HOOK函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#freertos栈溢出检测的2种方法"><span class="toc-number">1.17.</span> <span class="toc-text">freertos栈溢出检测的2种方法</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&text=嵌入式笔记：freertos RTOS"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&is_video=false&description=嵌入式笔记：freertos RTOS"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=嵌入式笔记：freertos RTOS&body=Check out this article: http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&title=嵌入式笔记：freertos RTOS"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://xiaowenxia.github.io/embedded-notes/2018/02/28/freertos-inside/&name=嵌入式笔记：freertos RTOS&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 xiaxiaowen
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/embedded-notes/">Home</a></li>
         
          <li><a href="/embedded-notes/about/">About</a></li>
         
          <li><a href="/embedded-notes/posts/">Writing</a></li>
         
          <li><a href="http://github.com/xiaowenxia">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/embedded-notes/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/embedded-notes/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/embedded-notes/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/embedded-notes/lib/jquery/jquery.min.js"></script>
<script src="/embedded-notes/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/embedded-notes/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-37473492-6', 'auto');
        ga('send', 'pageview');
    </script>



